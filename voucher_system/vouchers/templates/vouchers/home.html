{% extends 'base.html' %}
{% load static %}

{% block content %}
   {% if not user.is_authenticated %}
    <script>
        // Redirect to login page immediately
        window.location.href = "{% url 'login' %}";
    </script>
{% else %}
        <div class="dashboard-wrapper">
            <div class="container mt-5">
                <div class="text-center mb-5">
                    <h1 class="dashboard-title mb-4">Dashboard</h1>
                   

                    <!-- MAIN BUTTONS -->
                    <div class="d-flex justify-content-center gap-3 flex-wrap mb-5">
                        <a href="{% url 'voucher_list' %}" class="btn btn-primary btn-lg px-5 py-3 shadow-lg rounded-pill main-btn">
                            <i class="bi bi-receipt me-2"></i>Vouchers
                        </a>
                        <a href="{% url 'function' %}" class="btn btn-secondary btn-lg px-5 py-3 shadow-lg rounded-pill main-btn">
                            <i class="bi bi-calendar-event me-2"></i>Functions
                        </a>
                    </div>
                </div>

                <!-- SUPERUSER-ONLY CONTROL PANEL -->
                {% if user.is_superuser %}
                    <div class="text-center mb-4">
                        <h2 class="section-title">Administrative Controls</h2>
                        
                    </div>

                    <!-- 4 BOXES GRID -->
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4 justify-content-center">

                        <!-- Box 1 - User Master -->
                        <div class="col">
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#userMasterModal">
                                <div class="dashboard-card user-master-card">
                                    <div class="card-icon-wrapper">
                                        <i class="bi bi-people-fill card-icon"></i>
                                    </div>
                                    <h5 class="card-title">User Master</h5>
                                    <p class="card-description">Manage users and roles</p>
                                    <div class="card-overlay">
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Box 2 - Voucher Master -->
                        <div class="col">
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#voucherMasterModal">
                                <div class="dashboard-card voucher-master-card">
                                    <div class="card-icon-wrapper">
                                        <i class="bi bi-file-earmark-text-fill card-icon"></i>
                                    </div>
                                    <h5 class="card-title">Voucher Master</h5>
                                    <p class="card-description">Configure voucher settings</p>
                                    <div class="card-overlay">
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Box 3 - Approval Control -->
                        <div class="col">
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#approvalControlModalBox">
                                <div class="dashboard-card approval-control-card">
                                    <div class="card-icon-wrapper">
                                        <i class="bi bi-shield-check card-icon"></i>
                                    </div>
                                    <h5 class="card-title">Permissions</h5>
                                    <p class="card-description">Set approval workflows</p>
                                    <div class="card-overlay">
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Box 4 - Company Master -->
                        <div class="col">
                            <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#companyMasterModal">
                                <div class="dashboard-card company-master-card">
                                    <div class="card-icon-wrapper">
                                        {% if company_logo_url %}
                                            <img src="{{ company_logo_url }}" alt="Company Logo" class="card-icon-logo">
                                        {% else %}
                                            <i class="bi bi-building card-icon"></i>
                                        {% endif %}
                                    </div>
                                    <h5 class="card-title">Company Master</h5>
                                    <p class="card-description">Update company details</p>
                                    <div class="card-overlay">
                                        <i class="bi bi-arrow-right"></i>
                                    </div>
                                </div>
                            </a>
                        </div>

                    </div> <!-- end of row -->

                    <!-- ENHANCED MODALS WITH BETTER STYLING -->

                    <!-- User Master Modal -->
                    <div class="modal fade" id="userMasterModal" tabindex="-1" aria-labelledby="userMasterModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm">
                            <div class="modal-content border-0 rounded-4 shadow-lg">
                                <div class="modal-header bg-gradient-primary text-white rounded-top-4">
                                    <i class="bi bi-people-fill me-2"></i>
                                    <h5 class="modal-title fw-bold mb-0" id="userMasterModalLabel">User Management</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                                </div>
                                <div class="modal-body py-4">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#createUserModal" data-bs-dismiss="modal">
                                            <i class="bi bi-plus-circle me-2"></i>Create User
                                        </button>
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#createDesignationModal" data-bs-dismiss="modal">
                                            <i class="bi bi-star me-2"></i>Create Designation
                                        </button>
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#userControlModal" data-bs-dismiss="modal">
                                            <i class="bi bi-sliders me-2"></i>User Control
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voucher Master Modal -->
                    <div class="modal fade" id="voucherMasterModal" tabindex="-1" aria-labelledby="voucherMasterModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm">
                            <div class="modal-content border-0 rounded-4 shadow-lg">
                                <div class="modal-header bg-gradient-blue text-white rounded-top-4">
                                    <i class="bi bi-file-earmark-text me-2"></i>
                                    <h5 class="modal-title fw-bold mb-0" id="voucherMasterModalLabel">Voucher Settings</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                                </div>
                                <div class="modal-body py-4">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#accountControlModal" data-bs-dismiss="modal">
                                            <i class="bi bi-bank me-2"></i>Manage Bank Accounts
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Approval Control Modal -->
                    <div class="modal fade" id="approvalControlModalBox" tabindex="-1" aria-labelledby="approvalControlModalBoxLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm">
                            <div class="modal-content border-0 rounded-4 shadow-lg">
                                <div class="modal-header bg-gradient-green text-white rounded-top-4">
                                    <i class="bi bi-shield-check me-2"></i>
                                    <h5 class="modal-title fw-bold mb-0" id="approvalControlModalBoxLabel">Approval Settings</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                                </div>
                                <div class="modal-body py-4">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#approvalControlModal" data-bs-dismiss="modal">
                                            <i class="bi bi-list-ol me-2"></i>Control Approval
                                        </button>
                                        <button class="btn btn-outline-success fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#userRightsModal" data-bs-dismiss="modal">
                                            <i class="bi bi-key me-2"></i>User Rights
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Company Master Modal -->
                    <div class="modal fade" id="companyMasterModal" tabindex="-1" aria-labelledby="companyMasterModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm">
                            <div class="modal-content border-0 rounded-4 shadow-lg">
                                <div class="modal-header bg-gradient-red text-white rounded-top-4">
                                    <i class="bi bi-building me-2"></i>
                                    <h5 class="modal-title fw-bold mb-0" id="companyMasterModalLabel">Company Settings</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                                </div>
                                <div class="modal-body py-4">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary fw-semibold py-3 rounded-pill modal-btn"
                                                data-bs-toggle="modal" data-bs-target="#companyDetailsModal" data-bs-dismiss="modal">
                                            <i class="bi bi-info-circle me-2"></i>Company Details
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- ENHANCED CSS -->
                <style>
                    .dashboard-wrapper {
                        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                        min-height: 100vh;
                        padding: 2rem 0;
                    }

                    .dashboard-title {
                        font-size: 3rem;
                        font-weight: 700;
                        background: linear-gradient(135deg, #5b3cc4, #3f2ba8);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }

                    .section-title {
                        font-size: 2rem;
                        font-weight: 600;
                        color: #333;
                        margin-bottom: 0.5rem;
                    }

                    .main-btn {
                        font-size: 1.1rem;
                        font-weight: 600;
                        transition: all 0.3s ease;
                        border: none;
                    }

                    .main-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 10px 25px rgba(0,0,0,0.2) !important;
                    }

                    .dashboard-card {
                        position: relative;
                        border: none;
                        border-radius: 20px;
                        padding: 2rem 1.5rem;
                        text-align: center;
                        color: white;
                        min-height: 180px;
                        display: flex;
                        flex-direction: column;
                        justify-content: center;
                        align-items: center;
                        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                        overflow: hidden;
                        text-decoration: none;
                    }

                    .dashboard-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
                        opacity: 0;
                        transition: opacity 0.4s ease;
                        z-index: 1;
                    }

                    .dashboard-card:hover {
                        transform: translateY(-10px) scale(1.02);
                        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
                        text-decoration: none;
                        color: white;
                    }

                    .dashboard-card:hover::before {
                        opacity: 1;
                    }

                    .card-icon-wrapper {
                        width: 80px;
                        height: 80px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-bottom: 1rem;
                        background: rgba(255,255,255,0.2);
                        backdrop-filter: blur(10px);
                        transition: all 0.3s ease;
                    }

                    .dashboard-card:hover .card-icon-wrapper {
                        transform: scale(1.1);
                        background: rgba(255,255,255,0.3);
                    }

                    .card-icon {
                        font-size: 2.5rem;
                        opacity: 0.9;
                    }

                    .card-icon-logo {
                        width: 60px;
                        height: 60px;
                        object-fit: contain;
                        border-radius: 50%;
                        background: rgba(255,255,255,0.2);
                        padding: 0.5rem;
                    }

                    .card-title {
                        font-weight: 700;
                        font-size: 1.25rem;
                        margin-bottom: 0.5rem;
                        z-index: 2;
                        position: relative;
                    }

                    .card-description {
                        font-size: 0.9rem;
                        opacity: 0.9;
                        margin: 0;
                        z-index: 2;
                        position: relative;
                    }

                    .card-overlay {
                        position: absolute;
                        bottom: 1rem;
                        right: 1rem;
                        background: rgba(255,255,255,0.2);
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 1rem;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                        z-index: 2;
                    }

                    .dashboard-card:hover .card-overlay {
                        opacity: 1;
                        transform: scale(1.1);
                    }

                    /* Card Colors */
                    .user-master-card {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    }

                    .voucher-master-card {
                        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                    }

                    .approval-control-card {
                        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                    }

                    .company-master-card {
                        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
                    }

                    /* Modal Enhancements */
                    .bg-gradient-primary { background: linear-gradient(135deg,#667eea 0%, #764ba2 100%) !important; }
                    .bg-gradient-blue { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important; }
                    .bg-gradient-green { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important; }
                    .bg-gradient-red { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) }

                    .modal-btn {
                        transition: all 0.3s ease;
                        border: 2px solid;
                    }

                    .modal-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                    }

                    /* Responsive */
                    @media (max-width: 768px) {
                        .dashboard-title { font-size: 2.5rem; }
                        .section-title { font-size: 1.5rem; }
                        .dashboard-card { min-height: 160px; padding: 1.5rem 1rem; }
                        .card-icon-wrapper { width: 60px; height: 60px; }
                        .card-icon { font-size: 2rem; }
                    }
                </style>

                {% endif %} {# end superuser #}
            </div>
        </div>
    {% endif %}
{% endblock %}